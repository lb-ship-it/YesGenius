<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YES Genius v4.1 | Digital Diplomat</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#d4af37">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS: YES GENIUS v4.1 (Freemium Lux Edition) --- */
        :root {
            --bg-black: #050505;
            --card-bg: rgba(18, 18, 18, 0.75);
            --gold: #d4af37;
            --gold-light: #f3e5ab;
            --gold-dim: #aa8a2e;
            --accent-purple: #8b5cf6;
            --text-white: #ffffff;
            --text-gray: #a0a0a0;
            --glass-border: rgba(212, 175, 55, 0.25); 
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; font-family: 'Outfit', sans-serif;
            background-color: var(--bg-black);
            /* LUXUSN√ç POZAD√ç: Purpurov√Ω glow + Zlat√Ω st≈ôed + Tenk√° zlat√° m≈ô√≠≈æka */
            background-image: 
                radial-gradient(circle at top right, rgba(139, 92, 246, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 50% 10%, rgba(212, 175, 55, 0.08) 0%, transparent 60%),
                linear-gradient(rgba(212, 175, 55, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(212, 175, 55, 0.05) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 40px 40px, 40px 40px;
            background-attachment: fixed;
            color: var(--text-white); display: flex; justify-content: center;
            min-height: 100vh; padding-bottom: 30px;
        }

        .app-container { width: 100%; max-width: 500px; padding: 20px; display: flex; flex-direction: column; gap: 15px; position: relative; }

        /* HEADER */
        header { display: flex; align-items: flex-start; justify-content: space-between; padding: 15px 0 25px 0; width: 100%; gap: 10px; position: relative; z-index: 20; }
        .logo-wrapper { flex: 0 0 25%; max-width: 25%; }
        .logo-img { width: 100%; aspect-ratio: 1/1; border-radius: 14px; border: 1px solid var(--glass-border); object-fit: cover; background: #000; box-shadow: 0 4px 15px rgba(0,0,0,0.6); }
        .title-wrapper { flex: 1; display: flex; flex-direction: column; justify-content: center; overflow: hidden; padding-top: 2px; }
        h1 { font-size: 1.8rem; font-weight: 900; margin: 0; line-height: 0.95; letter-spacing: -0.5px; background: linear-gradient(to right, #fff 20%, var(--gold) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; white-space: nowrap; }
        .subtitle { color: var(--gold); font-size: 0.75rem; margin-top: 5px; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase; }
        
        .lang-wrapper { flex: 0 0 auto; display: flex; justify-content: flex-end; }
        .lang-select { background: rgba(5,5,5,0.8); color: var(--gold); border: 1px solid var(--glass-border); padding: 10px 8px; border-radius: 10px; font-size: 0.85rem; outline: none; cursor: pointer; font-weight: 600; text-align: right; min-width: 130px; appearance: none; -webkit-appearance: none; background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23d4af37%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 8px top 50%; background-size: 10px auto; padding-right: 25px; transition: border-color 0.3s; backdrop-filter: blur(5px); }
        .lang-select:focus { border-color: var(--gold); box-shadow: 0 0 12px rgba(212, 175, 55, 0.4); }
        @media (max-width: 480px) { h1 { font-size: 1.5rem; } .lang-select { min-width: 0; width: 35px; height: 35px; padding: 0; font-size: 1rem; text-align: center; background-image: none; overflow: hidden; white-space: nowrap; text-indent: 0; display: flex; justify-content: center; } }

        /* FORM CARD */
        .glass-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: var(--radius); padding: 25px 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); z-index: 50; }
        .input-group { margin-bottom: 22px; position: relative; }
        label { display: block; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-gray); margin-bottom: 8px; font-weight: 600; }
        .smart-input-wrapper { position: relative; display: flex; align-items: center; width: 100%; }
        
        input, select { width: 100%; padding: 16px; padding-right: 45px; background: rgba(5,5,5,0.6); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 12px; color: white; font-size: 1rem; font-family: inherit; outline: none; transition: 0.3s; appearance: none; -webkit-appearance: none; }
        input:focus, select:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); background: rgba(15,15,15,0.9); }

        /* CUSTOM DROPDOWNS LUX */
        .custom-dropdown-list { 
            position: absolute; top: calc(100% + 4px); left: 0; width: 100%; 
            max-height: 250px; overflow-y: auto; background: rgba(15, 15, 15, 0.95); 
            border: 1px solid var(--gold); border-radius: 12px; z-index: 1000; 
            display: none; box-shadow: 0 15px 40px rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            animation: slideDown 0.2s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-item { padding: 14px 16px; cursor: pointer; color: #ddd; font-size: 0.95rem; border-bottom: 1px solid rgba(255,255,255,0.05); transition: all 0.2s; }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background: linear-gradient(90deg, rgba(212, 175, 55, 0.2), transparent); color: var(--gold); padding-left: 22px; border-left: 3px solid var(--gold); }
        
        #format { background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23d4af37%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 15px top 50%; background-size: 12px auto; }
        .dropdown-arrow { position: absolute; right: 15px; color: var(--gold); font-size: 0.8rem; pointer-events: none; opacity: 0.8; }
        .reset-btn { position: absolute; right: 10px; background: rgba(5,5,5,0.8); border: none; color: #888; font-size: 1.1rem; cursor: pointer; padding: 5px 8px; display: none; border-radius: 6px; z-index: 10; transition: 0.2s; }
        .reset-btn:hover { color: var(--gold); background: rgba(255,255,255,0.1); }
        .arrow-btn { position: absolute; right: 0; top: 0; width: 45px; height: 100%; background: transparent; border: none; cursor: pointer; z-index: 5; }

        /* BUTTONS */
        .btn-main { width: 100%; padding: 20px; margin-top: 10px; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dim) 100%); border: none; border-radius: 12px; color: #000; font-weight: 900; font-size: 1.25rem; text-transform: uppercase; cursor: pointer; box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3); transition: transform 0.2s, box-shadow 0.2s; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-main:active { transform: scale(0.98); }
        .btn-main:hover { box-shadow: 0 8px 30px rgba(212, 175, 55, 0.5); }

        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 9999; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-card { background: rgba(10,10,10,0.95); border: 1px solid var(--gold); border-radius: 24px; padding: 30px; text-align: center; max-width: 400px; width: 100%; box-shadow: 0 0 60px rgba(212, 175, 55, 0.3); animation: slideIn 0.4s ease; position: relative; }
        .modal-title { font-size: 1.5rem; font-weight: 900; color: var(--gold); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .modal-text { color: #ddd; margin-bottom: 20px; line-height: 1.5; font-size: 0.95rem; }
        .close-modal { position: absolute; top: 15px; right: 20px; color: #666; font-size: 1.5rem; cursor: pointer; transition: 0.2s; }
        .close-modal:hover { color: #fff; }
        .key-input { width: 100%; padding: 15px; margin-bottom: 15px; background: #111; border: 1px solid #444; border-radius: 10px; color: var(--gold); font-family: monospace; font-size: 1.1rem; text-align: center; letter-spacing: 2px; }
        .key-input:focus { border-color: var(--gold); }

        /* VIP FOOTER */
        .vip-footer { margin-top: 30px; padding: 30px 20px; background: linear-gradient(180deg, rgba(20,20,20,0.7) 0%, rgba(5,5,5,0.9) 100%); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 24px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.4); position: relative; z-index: 10; }
        .vip-title { color: var(--gold); font-size: 0.9rem; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }
        .benefits-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-bottom: 25px; font-size: 0.8rem; color: #ccc; }
        .benefit-item { white-space: nowrap; } .bullet { color: var(--gold); margin-right: 4px; }
        .btn-vip-large { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--gold) 0%, #d6ae36 40%, #aa8a2e 100%); border: none; border-radius: 50px; color: #000; cursor: pointer; box-shadow: 0 0 25px rgba(212, 175, 55, 0.3); transition: transform 0.2s; display: flex; flex-direction: column; align-items: center; }
        .btn-vip-large:hover { transform: scale(1.02); box-shadow: 0 0 40px rgba(212, 175, 55, 0.5); }
        .vip-btn-main-text { font-size: 1.1rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px; }
        .vip-btn-sub-text { font-size: 0.8rem; font-weight: 600; opacity: 0.9; margin-top: 3px; }

        #vysledek { display: none; margin-top: 25px; animation: fadeIn 0.6s ease; }
        .result-card { background: rgba(255,255,255,0.05); border-left: 3px solid var(--gold); padding: 20px; margin-bottom: 15px; border-radius: 10px; backdrop-filter: blur(5px); }
        .result-text { font-size: 1.05rem; line-height: 1.5; margin-bottom: 15px; color: #f0f0f0; }
        .action-row { display: flex; gap: 10px; }
        .btn-action { flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px; color: var(--gold); font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem; transition: 0.2s; }
        .btn-action:hover { background: rgba(255,255,255,0.2); }
        #loader { display: none; text-align: center; margin-top: 15px; color: var(--gold); font-weight: 600; text-shadow: 0 0 10px rgba(212,175,55,0.5); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="logo-wrapper"><img src="logo.png" alt="YES Genius Logo" class="logo-img" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'><rect width=\'100\' height=\'100\' fill=\'%23111\'/><text x=\'50\' y=\'55\' font-family=\'Arial\' font-size=\'30\' fill=\'%23d4af37\' text-anchor=\'middle\' dominant-baseline=\'middle\'>YES</text></svg>'"></div>
        <div class="title-wrapper">
            <h1>YES Genius</h1>
            <div id="ui-subtitle" class="subtitle">DIGITAL DIPLOMAT</div>
        </div>
        <div class="lang-wrapper">
            <select id="lang-select" class="lang-select" onchange="changeLanguage()">
                <option value="en-US" selected>üá∫üá∏ English</option>
                <option value="en-GB">üá¨üáß British</option>
                <option value="cs">üá®üáø ƒåe≈°tina</option>
                <option value="de">üá©üá™ Deutsch</option>
                <option value="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                <option value="es">üá™üá∏ Espa√±ol</option>
                <option value="fr">üá´üá∑ Fran√ßais</option>
                <option value="it">üáÆüáπ Italiano</option>
                <option value="pt">üáµüáπ Portugu√™s</option>
                <option value="pl">üáµüá± Polski</option>
                <option value="nl">üá≥üá± Nederlands</option>
                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                <option value="tr">üáπüá∑ T√ºrk√ße</option>
                <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                <option value="sv">üá∏üá™ Svenska</option>
                <option value="no">üá≥üá¥ Norsk</option>
                <option value="da">üá©üá∞ Dansk</option>
                <option value="fi">üá´üáÆ Suomi</option>
                <option value="el">üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
                <option value="ro">üá∑üá¥ Rom√¢nƒÉ</option>
            </select>
        </div>
    </header>

    <main class="glass-card">
        <div class="input-group">
            <label id="lbl-format">Format</label>
            <div class="smart-input-wrapper">
                <select id="format">
                    <option value="SMS" id="opt-sms">SMS / WhatsApp</option>
                    <option value="Email">Email</option>
                    <option value="Call">Phone Call Script</option>
                    <option value="Slack">Slack / Teams</option>
                </select>
            </div>
        </div>
        
        <div class="input-group">
            <label id="lbl-target">Recipient</label>
            <div class="smart-input-wrapper">
                <input type="text" id="adresat" class="smart-input" placeholder="Select or type..." autocomplete="off" oninput="filterDropdown('adresat')" onfocus="showDropdown('adresat')">
                <button class="arrow-btn" onclick="toggleDropdown('adresat', event)"></button>
                <div class="dropdown-arrow">‚ñº</div>
                <button class="reset-btn" id="res-adresat" onclick="clearInput('adresat', event)">‚úï</button>
                <div id="drop-adresat" class="custom-dropdown-list"></div>
            </div>
        </div>
        
        <div class="input-group">
            <label id="lbl-reason">Reason</label>
            <div class="smart-input-wrapper">
                <input type="text" id="kategorie" class="smart-input" placeholder="Select or type..." autocomplete="off" oninput="filterDropdown('kategorie')" onfocus="showDropdown('kategorie')">
                <button class="arrow-btn" onclick="toggleDropdown('kategorie', event)"></button>
                <div class="dropdown-arrow">‚ñº</div>
                <button class="reset-btn" id="res-kategorie" onclick="clearInput('kategorie', event)">‚úï</button>
                <div id="drop-kategorie" class="custom-dropdown-list"></div>
            </div>
        </div>
        
        <div class="input-group">
            <label id="lbl-style">Style</label>
            <div class="smart-input-wrapper">
                <input type="text" id="styl" class="smart-input" placeholder="Select or type..." autocomplete="off" oninput="filterDropdown('styl')" onfocus="showDropdown('styl')">
                <button class="arrow-btn" onclick="toggleDropdown('styl', event)"></button>
                <div class="dropdown-arrow">‚ñº</div>
                <button class="reset-btn" id="res-styl" onclick="clearInput('styl', event)">‚úï</button>
                <div id="drop-styl" class="custom-dropdown-list"></div>
            </div>
        </div>

        <button id="btn-generate" class="btn-main" onclick="handleGenerateClick()">
            YES <span id="btn-verb" style="margin-left: 5px;">GENERATE!</span>
        </button>
        <div id="loader">‚ú® AI is negotiating...</div>
    </main>

    <section id="vysledek">
        <label id="lbl-results" style="margin-bottom: 10px; display:block; color:var(--text-gray); font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; font-weight:600;">Your Drafts:</label>
        <div id="variants-container"></div>
    </section>

    <!-- Paywall Modal s Promo cenou -->
    <div id="paywall-modal" class="modal-overlay">
        <div class="modal-card">
            <span class="close-modal" onclick="closeModal('paywall-modal')">√ó</span>
            <div class="modal-title" id="ui-locked-title">üîí UNLOCK FULL ACCESS</div>
            <div class="modal-text" id="ui-locked-text">You've used your 3 free drafts! To continue using YES Genius, get a Lifetime License.</div>
            <button class="btn-vip-large" onclick="koupit()">
                <span class="vip-btn-main-text" id="paywall-btn-main">GET LICENSE ($9.99)</span>
                <span class="vip-btn-sub-text">
                    <span style="text-decoration: line-through; color: #888; margin-right: 5px;">$22.00</span>
                    PROMO OFFER
                </span>
            </button>
            <div style="margin-top: 20px; font-size: 0.8rem; color: #888; cursor: pointer; text-decoration: underline;" onclick="showKeyInput()" id="ui-have-key">I already have a key</div>
        </div>
    </div>

    <!-- Aktivace kl√≠ƒçe -->
    <div id="key-modal" class="modal-overlay">
        <div class="modal-card">
            <span class="close-modal" onclick="closeModal('key-modal')">√ó</span>
            <div class="modal-title" id="ui-key-title">üîë ENTER YOUR KEY</div>
            <div class="modal-text" id="ui-key-desc">Paste the license key you received in your email.</div>
            <input type="text" id="license-input" class="key-input" placeholder="YG-XXXX-XXXX">
            <button class="btn-vip-large" onclick="saveLicenseKey()">
                <span class="vip-btn-main-text" id="ui-key-btn">ACTIVATE</span>
            </button>
        </div>
    </div>

    <!-- √öspƒõch modal -->
    <div id="success-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-title" id="ui-success-title">üéâ ACCESS GRANTED</div>
            <div class="modal-text" id="ui-success-text">Your license is active! You can now generate unlimited drafts.</div>
            <button class="btn-vip-large" onclick="closeModal('success-modal'); location.reload();">
                <span class="vip-btn-main-text" id="ui-success-btn">START USING</span>
            </button>
        </div>
    </div>

    <!-- Patiƒçka -->
    <footer class="vip-footer">
        <div class="vip-title" id="vip-title">üëë UNLOCK FULL POTENTIAL</div>
        <div class="benefits-list">
            <span class="benefit-item"><span class="bullet">‚Ä¢</span><span id="b1">No Fees</span></span>
            <span class="benefit-item"><span class="bullet">‚Ä¢</span><span id="b2">Lifetime Access</span></span>
            <span class="benefit-item"><span class="bullet">‚Ä¢</span><span id="b3">Free Updates</span></span>
            <span class="benefit-item"><span class="bullet">‚Ä¢</span><span id="b4">Secure Payment</span></span>
        </div>
        <button class="btn-vip-large" onclick="koupit()">
            <span class="vip-btn-main-text" id="vip-btn-main">GET LIFETIME ACCESS</span>
            <span class="vip-btn-sub-text" id="vip-btn-sub">
                <span style="text-decoration: line-through; color: #666; margin-right: 5px;">$22.00</span>
                <span style="color: #fff;">PROMO: $9.99</span>
            </span>
        </button>
        <div class="privacy-note" id="privacy-note">We do not collect any personal data.</div>
    </footer>
</div>

<script>
    // TV≈ÆJ NOV√ù STRIPE ODKAZ (9.99 USD)
    const PAYMENT_LINK = "https://buy.stripe.com/28E4gAgBL1KA29g1nka7C05"; 
    
    // LICENƒåN√ç SYST√âM A POKUSY
    let userLicense = localStorage.getItem('yes_genius_license_v1');
    let freeTries = parseInt(localStorage.getItem('yes_genius_free_tries') || '0');

    // KOMPLETN√ç DATAB√ÅZE P≈òEKLAD≈Æ A KONTEXTU PRO 24 JAZYK≈Æ
    const translations = {
        'en-US': { sub: "DIGITAL DIPLOMAT", verb: "GENERATE!", fmt: "Format", tgt: "Recipient", rsn: "Reason", sty: "Style", ph: "Select or type...", res: "Your Drafts:", copy: "Copy", share: "Share", vipTitle: "üëë UNLOCK FULL POTENTIAL", b1: "No Monthly Fees", b2: "Lifetime Access", b3: "Free Updates", b4: "Secure Payment", vMain: "GET LIFETIME ACCESS", lockT: "üîí UNLOCK FULL ACCESS", lockX: "You've used your 3 free drafts! Get a Lifetime License.", haveKey: "I already have a key", keyT: "üîë ENTER KEY", keyD: "Paste the license key.", keyB: "ACTIVATE", succT: "üéâ ACCESS GRANTED", succD: "License active! Generate unlimited drafts.", succB: "START USING", privacy: "We do not collect any personal data.", recList: ["Boss", "Partner", "Wife", "Husband", "Mother-in-law", "Father-in-law", "Client", "Colleague", "Mom", "Dad", "Teacher"], rsnList: ["Running Late", "Feeling Sick", "Missed Deadline", "Canceling Plans", "Family Emergency", "Car Trouble"], styList: ["Professional", "Creative / Funny", "Slang / Street", "Dramatic", "Strictly Formal", "Casual", "Apologetic"] },
        'en-GB': { sub: "DIGITAL DIPLOMAT", verb: "GENERATE!", fmt: "Format", tgt: "Recipient", rsn: "Reason", sty: "Style", ph: "Select or type...", res: "Your Drafts:", copy: "Copy", share: "Share", vipTitle: "üëë UNLOCK FULL POTENTIAL", b1: "No Monthly Fees", b2: "Lifetime Access", b3: "Free Updates", b4: "Secure Payment", vMain: "GET LIFETIME ACCESS", lockT: "üîí UNLOCK FULL ACCESS", lockX: "You've used your 3 free drafts! Get a Lifetime License.", haveKey: "I already have a key", keyT: "üîë ENTER KEY", keyD: "Paste the license key.", keyB: "ACTIVATE", succT: "üéâ ACCESS GRANTED", succD: "License active! Generate unlimited drafts.", succB: "START USING", privacy: "We do not collect any personal data.", recList: ["Boss", "Partner", "Wife", "Husband", "Mother-in-law", "Father-in-law", "Client", "Colleague", "Mum", "Dad", "Tutor"], rsnList: ["Running Late", "Feeling Unwell", "Missed Deadline", "Canceling Plans", "Family Emergency", "Car Trouble"], styList: ["Professional", "Creative / Witty", "Slang / Roadman", "Dramatic", "Strictly Formal", "Casual", "Apologetic"] },
        'cs': { sub: "DIGIT√ÅLN√ç DIPLOMAT", verb: "GENERUJ!", fmt: "Form√°t", tgt: "Adres√°t", rsn: "D≈Øvod", sty: "Styl", ph: "Vyber nebo napi≈°...", res: "Tv√© n√°vrhy:", copy: "Kop√≠rovat", share: "Sd√≠let", vipTitle: "üëë ODEMKNI PLN√ù POTENCI√ÅL", b1: "≈Ω√°dn√© poplatky", b2: "Do≈æivotn√≠ p≈ô√≠stup", b3: "Aktualizace", b4: "Bezpeƒçn√° platba", vMain: "Z√çSKAT P≈ò√çSTUP", lockT: "üîí ODEMKNI P≈ò√çSTUP", lockX: "Vyu≈æil jsi 3 n√°vrhy zdarma! Po≈ôiƒè si do≈æivotn√≠ licenci.", haveKey: "U≈æ m√°m kl√≠ƒç", keyT: "üîë ZADEJ KL√çƒå", keyD: "Vlo≈æ licenƒçn√≠ kl√≠ƒç.", keyB: "AKTIVOVAT", succT: "üéâ P≈ò√çSTUP POVOLEN", succD: "Licence aktivn√≠! M≈Ø≈æe≈° generovat neomezenƒõ.", succB: "ZAƒå√çT POU≈Ω√çVAT", privacy: "Nesb√≠r√°me ≈æ√°dn√© osobn√≠ √∫daje.", recList: ["≈†√©f", "Partner", "Man≈æelka", "Man≈æel", "Tchynƒõ", "Tch√°n", "Klient", "Kolega", "M√°ma", "T√°ta", "Uƒçitel"], rsnList: ["Jdu pozdƒõ", "Jsem nemocn√Ω/√°", "Nest√≠h√°m term√≠n", "Ru≈°√≠m pl√°ny", "Rodinn√© d≈Øvody", "Porucha auta"], styList: ["Profesion√°ln√≠", "Kreativn√≠ / Vtipn√Ω", "Slang / Hovorov√Ω", "Dramatick√Ω", "Form√°ln√≠", "Neform√°ln√≠", "Omluvn√Ω"] },
        'de': { sub: "DIGITALER DIPLOMAT", verb: "GENERIEREN!", fmt: "Format", tgt: "Empf√§nger", rsn: "Grund", sty: "Stil", ph: "W√§hlen oder tippen...", res: "Entw√ºrfe:", copy: "Kopieren", share: "Teilen", vipTitle: "üëë POTENZIAL FREISCHALTEN", b1: "Keine Geb√ºhren", b2: "Lebenslang", b3: "Updates", b4: "Sichere Zahlung", vMain: "ZUGANG ERHALTEN", lockT: "üîí ZUGANG FREISCHALTEN", lockX: "3 kostenlose Versuche aufgebraucht!", haveKey: "Ich habe einen Schl√ºssel", keyT: "üîë SCHL√úSSEL EINGEBEN", keyD: "Lizenzschl√ºssel einf√ºgen.", keyB: "AKTIVIEREN", succT: "üéâ ZUGANG GEW√ÑHRT", succD: "Lizenz aktiv!", succB: "STARTEN", privacy: "Wir sammeln keine Daten.", recList: ["Chef", "Partner", "Ehefrau", "Ehemann", "Schwiegermutter", "Schwiegervater", "Kunde", "Kollege", "Mama", "Papa"], rsnList: ["Versp√§tung", "Krankheit", "Deadline verpasst", "Absage", "Notfall", "Autopanne"], styList: ["Professionell", "Kreativ", "Slang", "Dramatisch", "Formell", "Locker", "Entschuldigend"] },
        'es': { sub: "DIPLOM√ÅTICO DIGITAL", verb: "¬°GENERAR!", fmt: "Formato", tgt: "Destinatario", rsn: "Raz√≥n", sty: "Estilo", ph: "Selecciona o escribe...", res: "Borradores:", copy: "Copiar", share: "Compartir", vipTitle: "üëë DESBLOQUEA TODO", b1: "Sin cuotas", b2: "Acceso de por vida", b3: "Actualizaciones", b4: "Pago seguro", vMain: "OBTENER ACCESO", lockT: "üîí DESBLOQUEAR", lockX: "¬°Has usado tus 3 intentos gratis!", haveKey: "Ya tengo una clave", keyT: "üîë INTRODUCIR CLAVE", keyD: "Pega la clave.", keyB: "ACTIVAR", succT: "üéâ ACCESO OTORGADO", succD: "¬°Licencia activa!", succB: "EMPEZAR", privacy: "No recopilamos datos.", recList: ["Jefe", "Pareja", "Esposa", "Esposo", "Suegra", "Suegro", "Cliente", "Colega", "Mam√°", "Pap√°"], rsnList: ["Llego tarde", "Enfermo", "Plazo perdido", "Cancelar planes", "Emergencia", "Coche averiado"], styList: ["Profesional", "Creativo", "Jerga", "Dram√°tico", "Formal", "Casual", "Disculpa"] },
        'fr': { sub: "DIPLOMATE NUM√âRIQUE", verb: "G√âN√âRER!", fmt: "Format", tgt: "Destinataire", rsn: "Raison", sty: "Style", ph: "Choisir ou √©crire...", res: "Brouillons:", copy: "Copier", share: "Partager", vipTitle: "üëë D√âBLOQUER LE POTENTIEL", b1: "Sans frais", b2: "Acc√®s √† vie", b3: "Mises √† jour", b4: "Paiement s√©curis√©", vMain: "OBTENIR L'ACC√àS", lockT: "üîí D√âBLOQUER", lockX: "3 essais gratuits utilis√©s!", haveKey: "J'ai d√©j√† une cl√©", keyT: "üîë ENTRER LA CL√â", keyD: "Coller la cl√© de licence.", keyB: "ACTIVER", succT: "üéâ ACC√àS AUTORIS√â", succD: "Licence active!", succB: "COMMENCER", privacy: "Nous ne collectons aucune donn√©e.", recList: ["Patron", "Partenaire", "Femme", "Mari", "Belle-m√®re", "Beau-p√®re", "Client", "Coll√®gue", "Maman", "Papa"], rsnList: ["En retard", "Malade", "D√©lai manqu√©", "Annulation", "Urgence", "Panne de voiture"], styList: ["Professionnel", "Cr√©atif", "Argot", "Dramatique", "Formel", "D√©contract√©", "Excuse"] },
        'it': { sub: "DIPLOMATICO DIGITALE", verb: "GENERA!", fmt: "Formato", tgt: "Destinatario", rsn: "Motivo", sty: "Stile", ph: "Seleziona o scrivi...", res: "Bozze:", copy: "Copia", share: "Condividi", vipTitle: "üëë SBLOCCA IL POTENZIALE", b1: "Nessun canone", b2: "Accesso a vita", b3: "Aggiornamenti", b4: "Pagamento sicuro", vMain: "OTTIENI ACCESSO", lockT: "üîí SBLOCCA", lockX: "Hai usato 3 prove gratuite!", haveKey: "Ho gi√† una chiave", keyT: "üîë INSERISCI CHIAVE", keyD: "Incolla la chiave.", keyB: "ATTIVA", succT: "üéâ ACCESSO CONSENTITO", succD: "Licenza attiva!", succB: "INIZIA", privacy: "Non raccogliamo dati personali.", recList: ["Capo", "Partner", "Moglie", "Marito", "Suocera", "Suocero", "Cliente", "Collega", "Mamma", "Pap√†"], rsnList: ["In ritardo", "Malato", "Scadenza persa", "Cancellazione", "Emergenza", "Guasto auto"], styList: ["Professionale", "Creativo", "Slang", "Drammatico", "Formale", "Informale", "Scusa"] },
        'pt': { sub: "DIPLOMATA DIGITAL", verb: "GERAR!", fmt: "Formato", tgt: "Destinat√°rio", rsn: "Raz√£o", sty: "Estilo", ph: "Selecione ou digite...", res: "Rascunhos:", copy: "Copiar", share: "Partilhar", vipTitle: "üëë DESBLOQUEAR POTENCIAL", b1: "Sem mensalidade", b2: "Vital√≠cio", b3: "Atualiza√ß√µes", b4: "Pagamento seguro", vMain: "OBTER ACESSO", lockT: "üîí DESBLOQUEAR", lockX: "Usaste 3 tentativas gr√°tis!", haveKey: "J√° tenho uma chave", keyT: "üîë INSERIR CHAVE", keyD: "Cole a chave.", keyB: "ATIVAR", succT: "üéâ ACESSO CONCEDIDO", succD: "Licen√ßa ativa!", succB: "COME√áAR", privacy: "N√£o coletamos dados.", recList: ["Chefe", "Parceiro", "Esposa", "Marido", "Sogra", "Sogro", "Cliente", "Colega", "M√£e", "Pai"], rsnList: ["Atrasado", "Doente", "Prazo perdido", "Cancelar planos", "Emerg√™ncia", "Problema no carro"], styList: ["Profissional", "Criativo", "G√≠ria", "Dram√°tico", "Formal", "Casual", "Desculpa"] },
        'pl': { sub: "CYFROWY DYPLOMATA", verb: "GENERUJ!", fmt: "Format", tgt: "Odbiorca", rsn: "Pow√≥d", sty: "Styl", ph: "Wybierz lub wpisz...", res: "Szkice:", copy: "Kopiuj", share: "Udostƒôpnij", vipTitle: "üëë ODBLOKUJ POTENCJA≈Å", b1: "Bez op≈Çat", b2: "Do≈ºywotni dostƒôp", b3: "Aktualizacje", b4: "Bezpiecznie", vMain: "UZYSKAJ DOSTƒòP", lockT: "üîí ODBLOKUJ", lockX: "Wykorzysta≈Çe≈õ 3 darmowe pr√≥by!", haveKey: "Mam ju≈º klucz", keyT: "üîë WPROWADZ KLUCZ", keyD: "Wklej klucz licencji.", keyB: "AKTYWUJ", succT: "üéâ DOSTƒòP PRZYZNANY", succD: "Licencja aktywna!", succB: "ZACZNIJ", privacy: "Nie zbieramy danych.", recList: ["Szef", "Partner", "≈ªona", "MƒÖ≈º", "Te≈õciowa", "Te≈õƒá", "Klient", "Kolega", "Mama", "Tata"], rsnList: ["Sp√≥≈∫nienie", "Choroba", "Termin", "Odwo≈Çanie", "Nag≈Çy wypadek", "Awaria auta"], styList: ["Profesjonalny", "Kreatywny", "Slang", "Dramatyczny", "Formalny", "Lu≈∫ny", "PrzepraszajƒÖcy"] },
        'uk': { sub: "–¶–ò–§–†–û–í–ò–ô –î–ò–ü–õ–û–ú–ê–¢", verb: "–°–¢–í–û–†–ò–¢–ò!", fmt: "–§–æ—Ä–º–∞—Ç", tgt: "–û—Ç—Ä–∏–º—É–≤–∞—á", rsn: "–ü—Ä–∏—á–∏–Ω–∞", sty: "–°—Ç–∏–ª—å", ph: "–û–±–µ—Ä—ñ—Ç—å/–≤–≤–µ–¥—ñ—Ç—å...", res: "–ß–µ—Ä–Ω–µ—Ç–∫–∏:", copy: "–ö–æ–ø—ñ—é–≤–∞—Ç–∏", share: "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è", vipTitle: "üëë –†–û–ó–ë–õ–û–ö–£–ô –î–û–°–¢–£–ü", b1: "–ë–µ–∑ –æ–ø–ª–∞—Ç", b2: "–î–æ–≤—ñ—á–Ω–∏–π", b3: "–û–Ω–æ–≤–ª–µ–Ω–Ω—è", b4: "–ë–µ–∑–ø–µ—á–Ω–æ", vMain: "–û–¢–†–ò–ú–ê–¢–ò –î–û–°–¢–£–ü", lockT: "üîí –û–ë–ú–ï–ñ–ï–ù–û", lockX: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ 3 —Å–ø—Ä–æ–±–∏!", haveKey: "–ú–∞—é –∫–ª—é—á", keyT: "üîë –í–í–ï–°–¢–ò –ö–õ–Æ–ß", keyD: "–í—Å—Ç–∞–≤—Ç–µ –∫–ª—é—á.", keyB: "–ê–ö–¢–ò–í–£–í–ê–¢–ò", succT: "üéâ –î–û–°–¢–£–ü –í–Ü–î–ö–†–ò–¢–û", succD: "–õ—ñ—Ü–µ–Ω–∑—ñ—è –∞–∫—Ç–∏–≤–Ω–∞!", succB: "–ü–û–ß–ê–¢–ò", privacy: "–ú–∏ –Ω–µ –∑–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ.", recList: ["–ë–æ—Å", "–ü–∞—Ä—Ç–Ω–µ—Ä", "–î—Ä—É–∂–∏–Ω–∞", "–ß–æ–ª–æ–≤—ñ–∫", "–¢–µ—â–∞/–°–≤–µ–∫—Ä—É—Ö–∞", "–ö–ª—ñ—î–Ω—Ç", "–ö–æ–ª–µ–≥–∞"], rsnList: ["–ó–∞–ø—ñ–∑–Ω—é—é—Å—è", "–•–≤–æ—Ä–æ–±–∞", "–ó—Ä–∏–≤ –¥–µ–¥–ª–∞–π–Ω—É", "–°–∫–∞—Å—É–≤–∞–Ω–Ω—è", "–°—ñ–º–µ–π–Ω—ñ –æ–±—Å—Ç–∞–≤–∏–Ω–∏"], styList: ["–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π", "–ö—Ä–µ–∞—Ç–∏–≤–Ω–∏–π", "–°–ª–µ–Ω–≥", "–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π", "–í–∏–±–∞—á–∞–ª—å–Ω–∏–π"] },
        'ru': { sub: "–¶–ò–§–†–û–í–û–ô –î–ò–ü–õ–û–ú–ê–¢", verb: "–°–û–ó–î–ê–¢–¨!", fmt: "–§–æ—Ä–º–∞—Ç", tgt: "–ü–æ–ª—É—á–∞—Ç–µ–ª—å", rsn: "–ü—Ä–∏—á–∏–Ω–∞", sty: "–°—Ç–∏–ª—å", ph: "–í—ã–±–µ—Ä–∏—Ç–µ/–≤–≤–µ–¥–∏—Ç–µ...", res: "–ß–µ—Ä–Ω–æ–≤–∏–∫–∏:", copy: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å", share: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è", vipTitle: "üëë –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–¢–¨ –î–û–°–¢–£–ü", b1: "–ë–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏", b2: "–í–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø", b3: "–û–±–Ω–æ–≤–ª–µ–Ω–∏—è", b4: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ", vMain: "–ü–û–õ–£–ß–ò–¢–¨ –î–û–°–¢–£–ü", lockT: "üîí –î–û–°–¢–£–ü –û–ì–†–ê–ù–ò–ß–ï–ù", lockX: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 3 –ø–æ–ø—ã—Ç–∫–∏!", haveKey: "–£ –º–µ–Ω—è –µ—Å—Ç—å –∫–ª—é—á", keyT: "üîë –í–í–ï–°–¢–ò –ö–õ–Æ–ß", keyD: "–í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á.", keyB: "–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨", succT: "üéâ –î–û–°–¢–£–ü –û–¢–ö–†–´–¢", succD: "–õ–∏—Ü–µ–Ω–∑–∏—è –∞–∫—Ç–∏–≤–Ω–∞!", succB: "–ù–ê–ß–ê–¢–¨", privacy: "–ú—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ.", recList: ["–ë–æ—Å—Å", "–ü–∞—Ä—Ç–Ω–µ—Ä", "–ñ–µ–Ω–∞", "–ú—É–∂", "–ö–ª–∏–µ–Ω—Ç", "–ö–æ–ª–ª–µ–≥–∞", "–ú–∞–º–∞", "–ü–∞–ø–∞"], rsnList: ["–û–ø–∞–∑–¥—ã–≤–∞—é", "–ó–∞–±–æ–ª–µ–ª", "–°—Ä—ã–≤ —Å—Ä–æ–∫–æ–≤", "–û—Ç–º–µ–Ω–∞ –ø–ª–∞–Ω–æ–≤", "–ß–ü –≤ —Å–µ–º—å–µ"], styList: ["–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π", "–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π", "–°–ª–µ–Ω–≥", "–§–æ—Ä–º–∞–ª—å–Ω—ã–π", "–ò–∑–≤–∏–Ω—è—é—â–∏–π—Å—è"] },
        'tr': { sub: "Dƒ∞Jƒ∞TAL Dƒ∞PLOMAT", verb: "OLU≈ûTUR!", fmt: "Bi√ßim", tgt: "Alƒ±cƒ±", rsn: "Sebep", sty: "Tarz", ph: "Se√ß veya yaz...", res: "Taslaklar:", copy: "Kopyala", share: "Payla≈ü", vipTitle: "üëë TAM ERƒ∞≈ûƒ∞M", b1: "Aylƒ±k √ºcret yok", b2: "√ñm√ºr boyu", b3: "G√ºncellemeler", b4: "G√ºvenli", vMain: "ERƒ∞≈ûƒ∞M AL", lockT: "üîí Kƒ∞Lƒ∞Dƒ∞ A√á", lockX: "3 √ºcretsiz deneme bitti!", haveKey: "Anahtarƒ±m var", keyT: "üîë ANAHTARI Gƒ∞R", keyD: "Anahtarƒ± yapƒ±≈ütƒ±r.", keyB: "AKTƒ∞FLE≈ûTƒ∞R", succT: "üéâ ERƒ∞≈ûƒ∞M SAƒûLANDI", succD: "Lisans aktif!", succB: "BA≈ûLA", privacy: "Veri toplamƒ±yoruz.", recList: ["Patron", "Partner", "E≈ü", "M√º≈üteri", "Meslekta≈ü", "Anne", "Baba"], rsnList: ["Ge√ß kaldƒ±m", "Hasta", "Son tarih", "ƒ∞ptal", "Acil"], styList: ["Profesyonel", "Yaratƒ±cƒ±", "Argo", "Resmi", "√ñz√ºr"] },
        'nl': { sub: "DIGITALE DIPLOMAAT", verb: "GENEREREN!", fmt: "Formaat", tgt: "Ontvanger", rsn: "Reden", sty: "Stijl", ph: "Kies of typ...", res: "Concepten:", copy: "Kopi√´ren", share: "Delen", vipTitle: "üëë ONTGRENDEL POTENTIEEL", b1: "Geen kosten", b2: "Levenslang", b3: "Updates", b4: "Veilig", vMain: "KRIJG TOEGANG", lockT: "üîí ONTGRENDELEN", lockX: "3 gratis pogingen gebruikt!", haveKey: "Ik heb een sleutel", keyT: "üîë VOER SLEUTEL IN", keyD: "Plak de sleutel.", keyB: "ACTIVEREN", succT: "üéâ TOEGANG VERLEEND", succD: "Licentie actief!", succB: "STARTEN", privacy: "We verzamelen geen data.", recList: ["Baas", "Partner", "Vrouw", "Man", "Klant", "Collega"], rsnList: ["Te laat", "Ziek", "Deadline gemist", "Afzeggen", "Noodgeval"], styList: ["Professioneel", "Creatief", "Straattaal", "Formeel", "Verontschuldigend"] },
        // Fallback for rest to keep it robust but concise for code size
        'default': { sub: "DIGITAL DIPLOMAT", verb: "GENERATE!", fmt: "Format", tgt: "Recipient", rsn: "Reason", sty: "Style", ph: "Select or type...", res: "Your Drafts:", copy: "Copy", share: "Share", vipTitle: "üëë UNLOCK FULL POTENTIAL", b1: "No Monthly Fees", b2: "Lifetime Access", b3: "Free Updates", b4: "Secure Payment", vMain: "GET LIFETIME ACCESS", lockT: "üîí UNLOCK FULL ACCESS", lockX: "You've used your 3 free drafts! Get a Lifetime License.", haveKey: "I already have a key", keyT: "üîë ENTER KEY", keyD: "Paste the license key.", keyB: "ACTIVATE", succT: "üéâ ACCESS GRANTED", succD: "License active!", succB: "START USING", privacy: "We do not collect any personal data.", recList: ["Boss", "Partner", "Client", "Colleague", "Wife", "Husband"], rsnList: ["Running Late", "Sick", "Missed Deadline", "Emergency"], styList: ["Professional", "Casual", "Slang"] }
    };

    function getTexts(lang) { 
        return translations[lang] || translations['en-US'] || translations['default']; 
    }

    // --- CHYTR√Å LOGIKA PRO NA≈†Ept√°vaƒçe (Kontext) ---
    function getContextualReasons(t, adresatValue) {
        if (!adresatValue) return t.rsnList;
        // Zjist√≠me, jestli u≈æivatel napsal/vybral pracovn√≠ nebo osobn√≠ kontakt
        let idx = t.recList.findIndex(r => r.toLowerCase() === adresatValue.toLowerCase());
        if (idx === -1) return t.rsnList; 

        // Indexy: 0=Boss, 6=Client, 7=Colleague, 10=Teacher (pracovn√≠)
        const workIndices = [0, 6, 7, 10];
        
        // Se≈ôad√≠me d≈Øvody podle toho, na koho c√≠l√≠ (funguje nap≈ô√≠ƒç v≈°emi jazyky d√≠ky index≈Øm)
        // 0=Late, 1=Sick, 2=Deadline, 3=Cancel, 4=Emergency, 5=Car
        let workReasonsOrder = [2, 1, 0, 5, 4, 3]; 
        let personalReasonsOrder = [3, 4, 0, 5, 1, 2]; 

        let order = workIndices.includes(idx) ? workReasonsOrder : personalReasonsOrder;
        
        let contextualList = order.map(i => t.rsnList[i]).filter(Boolean);
        // Dopln√≠me p≈ô√≠padn√© chybƒõj√≠c√≠ prvky (pokud m√° jazyk krat≈°√≠ seznam)
        t.rsnList.forEach(item => { if(!contextualList.includes(item)) contextualList.push(item); });
        
        return contextualList;
    }

    // --- UI FUNKCE ---
    function toggleReset(inputId) {
        const input = document.getElementById(inputId);
        const wrapper = input.parentElement;
        const btn = wrapper.querySelector('.reset-btn');
        const arrow = wrapper.querySelector('.dropdown-arrow');
        if (input.value.length > 0) { btn.style.display = 'block'; arrow.style.display = 'none'; } 
        else { btn.style.display = 'none'; arrow.style.display = 'block'; }
    }

    function clearInput(id, event) {
        if(event) { event.stopPropagation(); event.preventDefault(); }
        const input = document.getElementById(id);
        input.value = ''; 
        toggleReset(id); 
        setTimeout(() => { input.focus(); }, 10); 
    }

    function showDropdown(id) {
        closeAllDropdowns();
        const list = document.getElementById('drop-' + id);
        const input = document.getElementById(id);
        
        const lang = document.getElementById('lang-select').value;
        const t = getTexts(lang);
        let items = [];

        if (id === 'adresat') items = t.recList;
        if (id === 'kategorie') items = getContextualReasons(t, document.getElementById('adresat').value);
        if (id === 'styl') items = t.styList;

        const filter = input.value.toLowerCase();
        const filteredItems = items.filter(item => item.toLowerCase().includes(filter));

        if (filteredItems.length > 0) {
            list.innerHTML = '';
            filteredItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'dropdown-item'; 
                div.innerText = item;
                div.onmousedown = (e) => { e.preventDefault(); } // Zabr√°n√≠ ztr√°tƒõ focusu p≈ôed clickem
                div.onclick = function(e) {
                    e.stopPropagation();
                    input.value = item; 
                    toggleReset(id); 
                    closeAllDropdowns();
                    // Chytr√Ω skok na dal≈°√≠ pole
                    if (id === 'adresat') setTimeout(() => document.getElementById('kategorie').focus(), 50);
                    if (id === 'kategorie') setTimeout(() => document.getElementById('styl').focus(), 50);
                };
                list.appendChild(div);
            });
            list.style.display = 'block';
            input.style.borderBottomLeftRadius = '0';
            input.style.borderBottomRightRadius = '0';
            input.style.borderColor = 'var(--gold)';
        } else {
            list.style.display = 'none';
        }
    }

    function toggleDropdown(id, event) {
        if(event) { event.stopPropagation(); event.preventDefault(); }
        const list = document.getElementById('drop-' + id);
        if (list.style.display === 'block') { closeAllDropdowns(); } 
        else { document.getElementById(id).focus(); showDropdown(id); }
    }

    function filterDropdown(id) {
        toggleReset(id);
        showDropdown(id);
    }

    function closeAllDropdowns() {
        document.querySelectorAll('.custom-dropdown-list').forEach(l => l.style.display = 'none');
        document.querySelectorAll('.smart-input').forEach(i => {
            i.style.borderBottomLeftRadius = '12px';
            i.style.borderBottomRightRadius = '12px';
            i.style.borderColor = 'rgba(212, 175, 55, 0.3)';
        });
    }

    document.addEventListener('click', function(e) {
        if (!e.target.closest('.smart-input-wrapper')) { closeAllDropdowns(); }
    });

    function changeLanguage() {
        const lang = document.getElementById('lang-select').value;
        localStorage.setItem('yesGeniusLang', lang);
        const t = getTexts(lang);

        document.getElementById('ui-subtitle').innerText = t.sub;
        document.getElementById('lbl-format').innerText = t.fmt;
        document.getElementById('lbl-target').innerText = t.tgt;
        document.getElementById('lbl-reason').innerText = t.rsn;
        document.getElementById('lbl-style').innerText = t.sty;
        document.getElementById('lbl-results').innerText = t.res;
        
        document.getElementById('vip-title').innerText = t.vipTitle;
        document.getElementById('b1').innerText = t.b1; 
        document.getElementById('b2').innerText = t.b2;
        document.getElementById('b3').innerText = t.b3; 
        document.getElementById('b4').innerText = t.b4;
        document.getElementById('vip-btn-main').innerText = t.vMain;
        
        // Modaly
        document.getElementById('ui-locked-title').innerText = t.lockT;
        document.getElementById('ui-locked-text').innerText = t.lockX;
        document.getElementById('paywall-btn-main').innerText = t.vMain + " ($9.99)";
        document.getElementById('ui-have-key').innerText = t.haveKey;
        
        document.getElementById('ui-key-title').innerText = t.keyT;
        document.getElementById('ui-key-desc').innerText = t.keyD;
        document.getElementById('ui-key-btn').innerText = t.keyB;
        
        document.getElementById('ui-success-title').innerText = t.succT;
        document.getElementById('ui-success-text').innerText = t.succD;
        document.getElementById('ui-success-btn').innerText = t.succB;

        document.getElementById('privacy-note').innerText = t.privacy;

        document.querySelectorAll('.smart-input').forEach(inp => {
            inp.placeholder = t.ph;
            toggleReset(inp.id);
        });
        
        updateButtonStatus();
    }

    function updateButtonStatus() {
        const lang = document.getElementById('lang-select').value;
        const t = getTexts(lang);
        let zbyva = 3 - freeTries;
        
        if (userLicense) {
            document.getElementById('btn-verb').innerText = t.verb;
        } else if (zbyva > 0) {
            document.getElementById('btn-verb').innerText = `${t.verb} (${zbyva} FREE)`;
        } else {
            document.getElementById('btn-verb').innerText = t.verb;
        }
    }

    async function handleGenerateClick() {
        if (userLicense) {
            generovat();
        } else if (freeTries < 3) {
            freeTries++;
            localStorage.setItem('yes_genius_free_tries', freeTries.toString());
            updateButtonStatus();
            generovat();
        } else {
            document.getElementById('paywall-modal').style.display = 'flex';
        }
    }

    async function generovat() {
        const btn = document.getElementById('btn-generate');
        const loader = document.getElementById('loader');
        const results = document.getElementById('vysledek');
        
        const lang = document.getElementById('lang-select').value;

        const requestData = {
            format: document.getElementById('format').value,
            adresat: document.getElementById('adresat').value,
            kategorie: document.getElementById('kategorie').value, 
            styl: document.getElementById('styl').value,
            jazyk: lang
        };

        if(!requestData.adresat || !requestData.kategorie) { 
            alert("Please specify Recipient and Reason!"); 
            if(freeTries > 0 && !userLicense) { freeTries--; localStorage.setItem('yes_genius_free_tries', freeTries.toString()); updateButtonStatus(); }
            return; 
        }

        results.style.display = 'none';
        btn.style.opacity = '0.5';
        loader.style.display = 'block';

        try {
            const response = await fetch('/api/generovat', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) throw new Error(`Server Error: ${response.status}`);
            const data = await response.json();

            if (data.variants && Array.isArray(data.variants)) {
                zobrazitVysledky(data.variants);
            } else { throw new Error("Invalid data format"); }

        } catch (error) {
            console.error("GEN ERROR:", error); 
            // Vra≈• pokus p≈ôi chybƒõ spojen√≠
            if(!userLicense) { freeTries--; localStorage.setItem('yes_genius_free_tries', freeTries.toString()); updateButtonStatus(); }
            alert("Connection Error. Please try again.");
        } finally {
            loader.style.display = 'none'; btn.style.opacity = '1';
        }
    }

    function zobrazitVysledky(data) {
        const container = document.getElementById('variants-container');
        const lang = document.getElementById('lang-select').value;
        const t = getTexts(lang);
        container.innerHTML = '';
        
        data.forEach(text => {
            const div = document.createElement('div');
            div.className = 'result-card';
            const safeText = text.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            div.innerHTML = `
                <div class="result-text">${text}</div>
                <div class="action-row">
                    <button class="btn-action" onclick="kopirovat(this, '${safeText}')">üìã ${t.copy}</button>
                    <button class="btn-action" onclick="sdilet('${safeText}')">üîó ${t.share}</button>
                </div>`;
            container.appendChild(div);
        });
        document.getElementById('vysledek').style.display = 'block';
        document.getElementById('vysledek').scrollIntoView({ behavior: 'smooth' });
    }

    function kopirovat(btn, text) {
        navigator.clipboard.writeText(text).then(() => {
            let orig = btn.innerHTML; btn.innerHTML = "‚úÖ"; setTimeout(() => btn.innerHTML = orig, 1500);
        });
    }

    function sdilet(text) {
        if (navigator.share) navigator.share({ title: 'YES Genius', text: text }); else kopirovat(this, text);
    }

    function koupit() { window.location.href = PAYMENT_LINK; }
    
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function showKeyInput() { closeModal('paywall-modal'); document.getElementById('key-modal').style.display = 'flex'; }
    
    function saveLicenseKey() { 
        const key = document.getElementById('license-input').value.trim(); 
        if (key.length > 5) { 
            localStorage.setItem('yes_genius_license_v1', key); 
            userLicense = key; 
            closeModal('key-modal'); 
            document.getElementById('success-modal').style.display = 'flex';
            updateButtonStatus();
        } else { 
            alert("Invalid Key Format"); 
        } 
    }

    window.onload = function() {
        const savedLang = localStorage.getItem('yesGeniusLang');
        if (savedLang) { document.getElementById('lang-select').value = savedLang; }
        changeLanguage(); 
    }
</script>

</body>
</html>
